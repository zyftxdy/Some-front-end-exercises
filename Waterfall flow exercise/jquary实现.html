<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			*{
				margin: 0;
				padding: 0;
				border: 0;
			}
			div{display: block;}
			#main{
				position: relative;
			}
			.box{
				padding: 15px 0 0 15px;
				float: left;
			}
			.pic{
				padding: 10px;
				border: 1px solid #ccc;
				border-radius: 5px;
				box-shadow:0 0 5px #ccc;
			}
			.pic img{
				width: 165px;
				height: auto;
			}
		</style>
		<script src="../js/jquery-1.8.3.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			$( window ).on( "load", function(){
			    waterfall();
			    var dataInt={'data':[{'src':'23.jpg'},{'src':'24.jpg'},{'src':'25.jpg'},{'src':'26.jpg'}]};
			    window.onscroll=function(){
			        if(checkscrollside()){
			            $.each( dataInt.data, function( index, value ){
			                var obox = $('<div>').addClass('box').appendTo( $( "#main" ) );
			                var oBox = $('<div>').addClass('pic').appendTo( obox );
			                var oimg = $('<img>').attr('src','img/' + $( value).attr( 'src') ).appendTo(oBox);
			            });
			            waterfall();
			        };
			    }
			});
			
			/*
			    parend 父级id
			    box 元素id
			*/
			function waterfall(parent,box){
			    var $abox = $( "#main>div" );
			    var iboxW = $abox.eq( 0 ).outerWidth();// 一个块框box的宽
			    var num = Math.floor( $(window).width() / iboxW );//每行中能容纳的box个数【窗口宽度除以一个块框宽度】
			    //oParent.style.cssText='width:'+iboxW*num+'px;ma rgin:0 auto;';//设置父级居中样式：定宽+自动水平外边距
			    $("#main").width(iboxW*num).css('margin','0 auto');
			
			    var boxHArr=[];//用于存储 每列中的所有块框相加的高度。
			    $abox.each( function( index, value ){
			        var boxH = $abox.eq( index ).outerHeight();
			        if( index < num ){
			            boxHArr[ index ] = boxH; //第一行中的num个块框box 先添加进数组boxHArr
			        }else{
			            var minH = Math.min.apply( null, boxHArr );//数组boxHArr中的最小值minH
			            var minHIndex = $.inArray( minH, boxHArr );
			            $( value ).css({
			                'position': 'absolute',
			                'top': minH + 15,
			                'left': $abox.eq( minHIndex ).position().left
			            });
			            //数组 最小高元素的高 + 添加上的abox[i]块框高
			            boxHArr[ minHIndex ] += $abox.eq( index ).outerHeight() + 15;//更新添加了块框后的列高
			        }
			    });
			}
			
			function checkscrollside(){
			    var $abox = $( "#main>div" );
			    var lastboxH = $abox.last().get(0).offsetTop + Math.floor($abox.last().height()/2);//创建【触发添加块框函数waterfall()】的高度：最后一个块框的距离网页顶部+自身高的一半(实现未滚到底就开始加载)
			    var scrollTop = $( window ).scrollTop()//注意解决兼容性
			    var documentH = $( document ).width();//页面高度
			    return (lastboxH < scrollTop + documentH ) ? true : false;//到达指定高度后 返回true，触发waterfall()函数
			}
		</script>
	</head>
	<body>
		<div id="main">
			<div class="box">
				<div class="pic">
					<img src="img/0.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/1.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/2.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/3.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/4.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/5.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/6.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/7.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/8.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/9.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/10.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/11.jpg"/>
				</div>
			</div>
			
			<div class="box">
				<div class="pic">
					<img src="img/12.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/13.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/14.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/15.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/16.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/17.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/18.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/19.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/20.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/21.jpg"/>
				</div>
			</div>
			<div class="box">
				<div class="pic">
					<img src="img/22.jpg"/>
				</div>
			</div>
		</div>
	</body>
</html>

